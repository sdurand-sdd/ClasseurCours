<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classeur Num√©rique</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .controls {
            background: #f8f9fa;
            padding: 20px 30px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
            border-bottom: 2px solid #e9ecef;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-weight: 600;
            font-size: 0.9em;
            color: #495057;
        }

        select, input[type="date"], button {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .navigation {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .nav-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .nav-btn:disabled {
            background: #adb5bd;
            cursor: not-allowed;
        }

        .period-info {
            font-size: 1.2em;
            font-weight: 600;
            color: #495057;
            min-width: 150px;
            text-align: center;
        }

        .content {
            padding: 30px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-bottom: 30px;
        }

        .week-card {
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            background: #f8f9fa;
            transition: all 0.3s;
        }

        .week-card:hover {
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .week-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: 600;
            text-align: center;
        }

        .course-slot {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .course-slot:hover {
            border-color: #667eea;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.2);
        }

        .course-slot h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .course-date {
            color: #6c757d;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .course-content {
            color: #495057;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .course-homework {
            background: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            border-left: 4px solid #ffc107;
        }

        .course-notes {
            background: #d1ecf1;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            border-left: 4px solid #17a2b8;
            font-style: italic;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .modal-header h2 {
            color: #667eea;
        }

        .close-btn {
            background: #dc3545;
            padding: 8px 15px;
            font-size: 0.9em;
        }

        .close-btn:hover {
            background: #c82333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .save-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            margin-top: 10px;
        }

        .sequences-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .sequences-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .sequence-list {
            display: grid;
            gap: 15px;
        }

        .sequence-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sequence-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 0.9em;
        }

        .btn-edit {
            background: #28a745;
        }

        .btn-edit:hover {
            background: #218838;
        }

        .btn-delete {
            background: #dc3545;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .export-section {
            margin-top: 20px;
            padding: 20px;
            background: #e7f3ff;
            border-radius: 12px;
            text-align: center;
        }

        .export-btn {
            background: #28a745;
            margin: 5px;
        }

        .export-btn:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Classeur Num√©rique</h1>
            <p>Planification et suivi de cours</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>Classe</label>
                <select id="classSelect">
                    <option value="3-3">3¬∞3</option>
                    <option value="3-4">3¬∞4</option>
                    <option value="4-1">4¬∞1</option>
                    <option value="4-2">4¬∞2</option>
                </select>
            </div>

            <div class="navigation">
                <button class="nav-btn" id="prevPeriod">‚Üê Pr√©c√©dent</button>
                <div class="period-info" id="periodInfo">P√©riode 1</div>
                <button class="nav-btn" id="nextPeriod">Suivant ‚Üí</button>
            </div>

            <button onclick="openSequenceManager()">üîß G√©rer les s√©quences</button>
            <button onclick="openExportModal()">üíæ Exporter/Importer</button>
        </div>

        <div class="content">
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>
    </div>

    <!-- Modal pour √©diter un cours -->
    <div class="modal" id="courseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>√âditer le cours</h2>
                <button class="close-btn" onclick="closeCourseModal()">Fermer</button>
            </div>
            <form id="courseForm">
                <div class="form-group">
                    <label>Date du cours</label>
                    <input type="date" id="courseDate" required>
                </div>
                <div class="form-group">
                    <label>S√©quence</label>
                    <select id="courseSequence">
                        <option value="">-- Choisir une s√©quence --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Contenu du cours</label>
                    <textarea id="courseContent" placeholder="D√©tails du cours..."></textarea>
                </div>
                <div class="form-group">
                    <label>Travail √† faire</label>
                    <textarea id="courseHomework" placeholder="Devoirs, exercices..."></textarea>
                </div>
                <div class="form-group">
                    <label>Notes personnelles</label>
                    <textarea id="courseNotes" placeholder="Remarques, observations..."></textarea>
                </div>
                <button type="submit" class="save-btn">üíæ Enregistrer</button>
            </form>
        </div>
    </div>

    <!-- Modal pour g√©rer les s√©quences -->
    <div class="modal" id="sequenceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Gestion des s√©quences</h2>
                <button class="close-btn" onclick="closeSequenceManager()">Fermer</button>
            </div>
            
            <div class="form-group">
                <label>Nom de la s√©quence</label>
                <input type="text" id="sequenceName" placeholder="Ex: Th√©or√®me de Pythagore">
            </div>
            <div class="form-group">
                <label>Contenu type</label>
                <textarea id="sequenceContent" placeholder="Contenu par d√©faut pour cette s√©quence..."></textarea>
            </div>
            <div class="form-group">
                <label>Travail type</label>
                <textarea id="sequenceHomework" placeholder="Travail par d√©faut pour cette s√©quence..."></textarea>
            </div>
            <button onclick="addSequence()" class="save-btn">‚ûï Ajouter la s√©quence</button>

            <div class="sequences-section">
                <h3>S√©quences existantes</h3>
                <div class="sequence-list" id="sequenceList"></div>
            </div>
        </div>
    </div>

    <!-- Modal Export/Import -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Exporter / Importer les donn√©es</h2>
                <button class="close-btn" onclick="closeExportModal()">Fermer</button>
            </div>
            
            <div class="export-section">
                <h3>Exporter vos donn√©es</h3>
                <p>T√©l√©chargez vos donn√©es pour les sauvegarder ou les transf√©rer.</p>
                <button class="export-btn" onclick="exportData()">üì• T√©l√©charger les donn√©es</button>
            </div>

            <div class="export-section" style="background: #fff3cd; margin-top: 20px;">
                <h3>Importer des donn√©es</h3>
                <p>Restaurez vos donn√©es depuis un fichier pr√©c√©demment export√©.</p>
                <input type="file" id="importFile" accept=".json" style="margin: 10px 0;">
                <button class="export-btn" style="background: #ffc107;" onclick="importData()">üì§ Importer les donn√©es</button>
            </div>
        </div>
    </div>

    <script>
        // √âtat de l'application
        let state = {
            currentClass: '3-3',
            currentPeriod: 1,
            courses: {},
            sequences: {}
        };

        let currentEditingCourse = null;

        // Charger les donn√©es depuis le stockage
        function loadData() {
            const saved = localStorage.getItem('classeurData');
            if (saved) {
                state = JSON.parse(saved);
            }
        }

        // Sauvegarder les donn√©es
        function saveData() {
            localStorage.setItem('classeurData', JSON.stringify(state));
        }

        // Initialiser l'application
        function init() {
            loadData();
            document.getElementById('classSelect').value = state.currentClass;
            updatePeriodInfo();
            renderCalendar();
            updateNavigationButtons();

            // Event listeners
            document.getElementById('classSelect').addEventListener('change', (e) => {
                state.currentClass = e.target.value;
                state.currentPeriod = 1;
                renderCalendar();
                updateNavigationButtons();
                updatePeriodInfo();
                saveData();
            });

            document.getElementById('prevPeriod').addEventListener('click', () => {
                if (state.currentPeriod > 1) {
                    state.currentPeriod--;
                    renderCalendar();
                    updateNavigationButtons();
                    updatePeriodInfo();
                    saveData();
                }
            });

            document.getElementById('nextPeriod').addEventListener('click', () => {
                if (state.currentPeriod < 9) {
                    state.currentPeriod++;
                    renderCalendar();
                    updateNavigationButtons();
                    updatePeriodInfo();
                    saveData();
                }
            });

            document.getElementById('courseForm').addEventListener('submit', (e) => {
                e.preventDefault();
                saveCourse();
            });
        }

        function updatePeriodInfo() {
            document.getElementById('periodInfo').textContent = `P√©riode ${state.currentPeriod}`;
        }

        function updateNavigationButtons() {
            document.getElementById('prevPeriod').disabled = state.currentPeriod === 1;
            document.getElementById('nextPeriod').disabled = state.currentPeriod === 9;
        }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            const startWeek = (state.currentPeriod - 1) * 4 + 1;
            
            for (let week = 0; week < 4; week++) {
                const weekNumber = startWeek + week;
                const weekCard = document.createElement('div');
                weekCard.className = 'week-card';
                
                weekCard.innerHTML = `
                    <div class="week-header">Semaine ${weekNumber}</div>
                    ${renderCourseSlot(weekNumber, 1)}
                    ${renderCourseSlot(weekNumber, 2)}
                `;
                
                grid.appendChild(weekCard);
            }
        }

        function renderCourseSlot(week, courseNum) {
            const key = `${state.currentClass}-W${week}-C${courseNum}`;
            const course = state.courses[key] || {};
            
            const hasData = course.date || course.content || course.homework;
            
            return `
                <div class="course-slot" onclick="editCourse('${key}', ${week}, ${courseNum})">
                    <h4>Cours ${(week - 1) * 2 + courseNum}</h4>
                    ${course.date ? `<div class="course-date">üìÖ ${formatDate(course.date)}</div>` : '<div class="course-date">‚ö†Ô∏è Date non d√©finie</div>'}
                    ${course.sequence ? `<div class="course-content"><strong>S√©quence:</strong> ${course.sequence}</div>` : ''}
                    ${course.content ? `<div class="course-content">${truncate(course.content, 100)}</div>` : '<div class="course-content" style="color: #adb5bd;">Cliquez pour ajouter du contenu</div>'}
                    ${course.homework ? `<div class="course-homework"><strong>üìù √Ä faire:</strong> ${truncate(course.homework, 80)}</div>` : ''}
                    ${course.notes ? `<div class="course-notes"><strong>üí≠ Notes:</strong> ${truncate(course.notes, 80)}</div>` : ''}
                </div>
            `;
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toLocaleDateString('fr-FR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }

        function truncate(text, length) {
            if (!text) return '';
            return text.length > length ? text.substring(0, length) + '...' : text;
        }

        function editCourse(key, week, courseNum) {
            currentEditingCourse = key;
            const course = state.courses[key] || {};
            
            document.getElementById('courseDate').value = course.date || '';
            document.getElementById('courseContent').value = course.content || '';
            document.getElementById('courseHomework').value = course.homework || '';
            document.getElementById('courseNotes').value = course.notes || '';
            
            // Charger les s√©quences dans le select
            const select = document.getElementById('courseSequence');
            select.innerHTML = '<option value="">-- Choisir une s√©quence --</option>';
            const sequences = state.sequences[state.currentClass] || [];
            sequences.forEach((seq, idx) => {
                const option = document.createElement('option');
                option.value = idx;
                option.textContent = seq.name;
                if (course.sequence === seq.name) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
            
            document.getElementById('courseModal').classList.add('active');
        }

        function closeCourseModal() {
            document.getElementById('courseModal').classList.remove('active');
            currentEditingCourse = null;
        }

        function saveCourse() {
            if (!currentEditingCourse) return;
            
            const sequenceIdx = document.getElementById('courseSequence').value;
            let sequenceName = '';
            let defaultContent = '';
            let defaultHomework = '';
            
            if (sequenceIdx !== '') {
                const sequences = state.sequences[state.currentClass] || [];
                const sequence = sequences[sequenceIdx];
                if (sequence) {
                    sequenceName = sequence.name;
                    defaultContent = sequence.content || '';
                    defaultHomework = sequence.homework || '';
                }
            }
            
            const content = document.getElementById('courseContent').value || defaultContent;
            const homework = document.getElementById('courseHomework').value || defaultHomework;
            
            state.courses[currentEditingCourse] = {
                date: document.getElementById('courseDate').value,
                sequence: sequenceName,
                content: content,
                homework: homework,
                notes: document.getElementById('courseNotes').value
            };
            
            saveData();
            renderCalendar();
            closeCourseModal();
        }

        // Gestion des s√©quences
        function openSequenceManager() {
            renderSequenceList();
            document.getElementById('sequenceModal').classList.add('active');
        }

        function closeSequenceManager() {
            document.getElementById('sequenceModal').classList.remove('active');
            document.getElementById('sequenceName').value = '';
            document.getElementById('sequenceContent').value = '';
            document.getElementById('sequenceHomework').value = '';
        }

        function addSequence() {
            const name = document.getElementById('sequenceName').value.trim();
            if (!name) {
                alert('Veuillez entrer un nom de s√©quence');
                return;
            }
            
            if (!state.sequences[state.currentClass]) {
                state.sequences[state.currentClass] = [];
            }
            
            state.sequences[state.currentClass].push({
                name: name,
                content: document.getElementById('sequenceContent').value,
                homework: document.getElementById('sequenceHomework').value
            });
            
            saveData();
            renderSequenceList();
            
            document.getElementById('sequenceName').value = '';
            document.getElementById('sequenceContent').value = '';
            document.getElementById('sequenceHomework').value = '';
        }

        function renderSequenceList() {
            const list = document.getElementById('sequenceList');
            const sequences = state.sequences[state.currentClass] || [];
            
            if (sequences.length === 0) {
                list.innerHTML = '<div class="empty-state">Aucune s√©quence d√©finie pour cette classe</div>';
                return;
            }
            
            list.innerHTML = sequences.map((seq, idx) => `
                <div class="sequence-item">
                    <div>
                        <strong>${seq.name}</strong>
                        ${seq.content ? `<div style="font-size: 0.9em; color: #6c757d; margin-top: 5px;">${truncate(seq.content, 60)}</div>` : ''}
                    </div>
                    <div class="sequence-actions">
                        <button class="btn-small btn-delete" onclick="deleteSequence(${idx})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function deleteSequence(idx) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette s√©quence ?')) {
                state.sequences[state.currentClass].splice(idx, 1);
                saveData();
                renderSequenceList();
            }
        }

        // Export/Import
        function openExportModal() {
            document.getElementById('exportModal').classList.add('active');
        }

        function closeExportModal() {
            document.getElementById('exportModal').classList.remove('active');
        }

        function exportData() {
            const dataStr = JSON.stringify(state, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `classeur-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData() {
            const file = document.getElementById('importFile').files[0];
            if (!file) {
                alert('Veuillez s√©lectionner un fichier');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (confirm('Cette action remplacera toutes vos donn√©es actuelles. Continuer ?')) {
                        state = imported;
                        saveData();
                        renderCalendar();
                        closeExportModal();
                        alert('Donn√©es import√©es avec succ√®s !');
                    }
                } catch (error) {
                    alert('Erreur lors de l\'import : fichier invalide');
                }
            };
            reader.readAsText(file);
        }

        // D√©marrer l'application
        init();
    </script>
</body>
</html>